<h1 class="text-2xl font-bold mb-4">Detalle de Venta #<%= @sale.id %></h1>

<p class="mb-2"><strong>Cliente:</strong> <%= @sale.client.name %> (DNI: <%= @sale.client.dni %>)</p>
<p class="mb-2"><strong>Fecha:</strong> <%= @sale.sold_at.strftime("%d/%m/%Y %H:%M") if @sale.sold_at %></p>
<p class="mb-2"><strong>Estado:</strong> <%= @sale.cancelled_at.present? ? "Cancelada" : "Activa" %></p>

<table class="min-w-full bg-white border border-gray-200 mt-4">
  <thead class="bg-gray-100">
    <tr>
      <th class="py-2 px-4 border">Producto</th>
      <th class="py-2 px-4 border">Cantidad</th>
      <th class="py-2 px-4 border">Precio Unitario</th>
      <th class="py-2 px-4 border">Subtotal</th>
    </tr>
  </thead>
  <tbody>
    <% @sale.sale_details.each do |detail| %>
      <tr>
        <td class="py-2 px-4 border"><%= detail.product.name %></td>
        <td class="py-2 px-4 border"><%= detail.quantity %></td>
        <td class="py-2 px-4 border">$<%= number_to_currency(detail.unit_price, unit: "", separator: ",", delimiter: ".") %></td>
        <td class="py-2 px-4 border">$<%= number_to_currency(detail.quantity * detail.unit_price, unit: "", separator: ",", delimiter: ".") %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<p class="mt-4 text-lg font-semibold">Total: $<%= number_to_currency(@sale.total_amount, unit: "", separator: ",", delimiter: ".") %></p>

<% if @sale.cancelled_at.present? %>
  <p class="mt-4 text-red-600 font-semibold">Esta venta fue cancelada el <%= @sale.cancelled_at.strftime("%d/%m/%Y %H:%M") %></p>
<% else %>
  <%= button_to "Cancelar venta", cancel_sale_path(@sale), method: :patch, data: { confirm: "¿Estás seguro que querés cancelar esta venta?" }, class: "mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" %>
<% end %>

<%= link_to "Volver al listado", sales_path, class: "mt-6 inline-block text-blue-600 hover:underline" %>

