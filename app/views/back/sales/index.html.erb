<% content_for :title, "Ventas" %>

<section class="w-full px-6 py-10">
  <div class="mx-auto flex max-w-6xl flex-col gap-6">
    <header class="flex flex-col gap-2 border-b border-slate-200 pb-4">
      <p class="text-xs uppercase tracking-[0.35em] text-slate-500">Administración</p>
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <h1 class="text-3xl font-semibold text-slate-900">Ventas</h1>
          <p class="text-sm text-slate-500">Listá, filtrá y administrá las ventas registradas en la plataforma.</p>
        </div>
        <%= new_button(new_admin_sale_path,
              classes: "inline-flex items-center gap-2 rounded-full bg-(--accent) px-5 py-2 text-sm font-semibold text-white shadow transition hover:brightness-110") %>
      </div>
    </header>

    <%= form_with url: admin_sales_path, method: :get, local: true, class: "flex flex-wrap items-end gap-4" do |form| %>
      <div class="flex flex-col gap-2">
        <%= form.label :client_name, "Cliente", class: "text-sm font-medium text-slate-700" %>
        <%= form.text_field :client_name, value: params[:client_name], placeholder: "Nombre del cliente",
              class: "w-72 rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 shadow-sm focus:border-(--accent) focus:outline-none focus:ring-2 focus:ring-(--accent)/40" %>
      </div>
      <div class="flex flex-col gap-2">
        <%= form.label :from_date, "Desde", class: "text-sm font-medium text-slate-700" %>
        <%= form.date_field :from_date, value: params[:from_date],
              class: "rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 shadow-sm focus:border-(--accent) focus:outline-none focus:ring-2 focus:ring-(--accent)/40" %>
      </div>
      <div class="flex flex-col gap-2">
        <%= form.label :to_date, "Hasta", class: "text-sm font-medium text-slate-700" %>
        <%= form.date_field :to_date, value: params[:to_date],
              class: "rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 shadow-sm focus:border-(--accent) focus:outline-none focus:ring-2 focus:ring-(--accent)/40" %>
      </div>
      <div class="flex flex-col gap-2">
        <%= form.label :status, "Estado", class: "text-sm font-medium text-slate-700" %>
        <%= form.select :status,
              [["Todas", ""], ["Activas", "active"], ["Canceladas", "cancelled"]],
              { selected: params[:status] },
              class: "rounded-xl border border-slate-200 px-4 py-2 text-sm text-slate-900 shadow-sm focus:border-(--accent) focus:outline-none focus:ring-2 focus:ring-(--accent)/40" %>
      </div>
      <div class="flex gap-3">
        <%= form.submit "Aplicar filtros", class: "mt-6 rounded-full bg-slate-900 px-6 py-2 text-sm font-semibold text-white transition hover:bg-slate-700" %>
        <% if params[:client_name].present? || params[:from_date].present? || params[:to_date].present? || params[:status].present? %>
          <%= link_to "Limpiar", admin_sales_path, class: "mt-6 rounded-full border border-slate-300 px-6 py-2 text-sm font-semibold text-slate-600 hover:bg-slate-50" %>
        <% end %>
      </div>
    <% end %>

    <% if @sales.any? %>
      <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm">
        <div class="scrollbar-thin overflow-x-auto">
          <table class="min-w-full divide-y divide-slate-200 text-sm">
            <thead class="bg-slate-50 text-left text-xs font-semibold uppercase tracking-widest text-slate-500">
              <tr>
                <th scope="col" class="px-6 py-3">Cliente</th>
                <th scope="col" class="px-6 py-3">Fecha</th>
                <th scope="col" class="px-6 py-3">Total</th>
                <th scope="col" class="px-6 py-3">Estado</th>
                <th scope="col" class="px-6 py-3">Acciones</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-100 bg-white">
              <% @sales.each do |sale| %>
                <tr class="hover:bg-slate-50">
                  <td class="px-6 py-4 font-medium text-slate-900"><%= sale.client.name %></td>
                  <td class="px-6 py-4 text-slate-700"><%= l(sale.sold_at, format: :short) %></td>
                  <td class="px-6 py-4 font-medium text-slate-900"><%= number_to_currency(sale.total_amount) %></td>
                  <td class="px-6 py-4 text-slate-700">
                    <% if sale.cancelled_at.present? %>
                      <span class="rounded-full bg-red-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-red-600">Cancelada</span>
                    <% else %>
                      <span class="rounded-full bg-green-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-green-600">Activa</span>
                    <% end %>
                  </td>
                  <td class="px-6 py-4 text-right">
                    <%= show_button([:admin, sale],
                        classes: "rounded-full border border-slate-300 px-3 py-1 text-xs font-semibold text-slate-700 hover:bg-slate-100") %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <div class="border-t border-slate-200 bg-slate-50 px-6 py-4">
          <%= paginate @sales %>
        </div>
      </div>
    <% else %>
      <div class="rounded-2xl border border-dashed border-slate-200 bg-white/80 p-10 text-center text-slate-500">
        <p class="text-lg font-semibold">No encontramos ventas</p>
        <% if params[:client_name].present? || params[:from_date].present? || params[:to_date].present? || params[:status].present? %>
          <p class="mt-2 text-sm">Probá ajustando los filtros de búsqueda.</p>
        <% else %>
          <p class="mt-2 text-sm">Todavía no hay ventas registradas.</p>
        <% end %>
      </div>
    <% end %>
  </div>
</section>